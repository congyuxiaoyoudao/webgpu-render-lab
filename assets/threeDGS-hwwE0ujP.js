import{G as It}from"./lil-gui.esm-BXwgAigT.js";var Lt=1e-6,Rn=typeof Float32Array<"u"?Float32Array:Array;function Ot(){var e=new Rn(9);return Rn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function $t(e,r,M,D,E,S,_,z,U){var A=new Rn(9);return A[0]=e,A[1]=r,A[2]=M,A[3]=D,A[4]=E,A[5]=S,A[6]=_,A[7]=z,A[8]=U,A}function Nt(e,r){if(e===r){var M=r[1],D=r[2],E=r[5];e[1]=r[3],e[2]=r[6],e[3]=M,e[5]=r[7],e[6]=D,e[7]=E}else e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8];return e}function Xn(){var e=new Rn(16);return Rn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function vt(e,r){var M=r[0],D=r[1],E=r[2],S=r[3],_=r[4],z=r[5],U=r[6],A=r[7],V=r[8],G=r[9],I=r[10],L=r[11],O=r[12],H=r[13],j=r[14],m=r[15],J=M*z-D*_,$=M*U-E*_,Q=M*A-S*_,Y=D*U-E*z,Z=D*A-S*z,fn=E*A-S*U,cn=V*H-G*O,en=V*j-I*O,b=V*m-L*O,an=G*j-I*H,ln=G*m-L*H,hn=I*m-L*j,nn=J*hn-$*ln+Q*an+Y*b-Z*en+fn*cn;return nn?(nn=1/nn,e[0]=(z*hn-U*ln+A*an)*nn,e[1]=(E*ln-D*hn-S*an)*nn,e[2]=(H*fn-j*Z+m*Y)*nn,e[3]=(I*Z-G*fn-L*Y)*nn,e[4]=(U*b-_*hn-A*en)*nn,e[5]=(M*hn-E*b+S*en)*nn,e[6]=(j*Q-O*fn-m*$)*nn,e[7]=(V*fn-I*Q+L*$)*nn,e[8]=(_*ln-z*b+A*cn)*nn,e[9]=(D*b-M*ln-S*cn)*nn,e[10]=(O*Z-H*Q+m*J)*nn,e[11]=(G*Q-V*Z-L*J)*nn,e[12]=(z*en-_*an-U*cn)*nn,e[13]=(M*an-D*en+E*cn)*nn,e[14]=(H*$-O*Y-j*J)*nn,e[15]=(V*Y-G*$+I*J)*nn,e):null}function Xt(e,r,M){var D=r[0],E=r[1],S=r[2],_=r[3],z=r[4],U=r[5],A=r[6],V=r[7],G=r[8],I=r[9],L=r[10],O=r[11],H=r[12],j=r[13],m=r[14],J=r[15],$=M[0],Q=M[1],Y=M[2],Z=M[3];return e[0]=$*D+Q*z+Y*G+Z*H,e[1]=$*E+Q*U+Y*I+Z*j,e[2]=$*S+Q*A+Y*L+Z*m,e[3]=$*_+Q*V+Y*O+Z*J,$=M[4],Q=M[5],Y=M[6],Z=M[7],e[4]=$*D+Q*z+Y*G+Z*H,e[5]=$*E+Q*U+Y*I+Z*j,e[6]=$*S+Q*A+Y*L+Z*m,e[7]=$*_+Q*V+Y*O+Z*J,$=M[8],Q=M[9],Y=M[10],Z=M[11],e[8]=$*D+Q*z+Y*G+Z*H,e[9]=$*E+Q*U+Y*I+Z*j,e[10]=$*S+Q*A+Y*L+Z*m,e[11]=$*_+Q*V+Y*O+Z*J,$=M[12],Q=M[13],Y=M[14],Z=M[15],e[12]=$*D+Q*z+Y*G+Z*H,e[13]=$*E+Q*U+Y*I+Z*j,e[14]=$*S+Q*A+Y*L+Z*m,e[15]=$*_+Q*V+Y*O+Z*J,e}function st(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Wt(e,r){var M=r[0],D=r[1],E=r[2],S=r[3],_=M+M,z=D+D,U=E+E,A=M*_,V=D*_,G=D*z,I=E*_,L=E*z,O=E*U,H=S*_,j=S*z,m=S*U;return e[0]=1-G-O,e[1]=V+m,e[2]=I-j,e[3]=0,e[4]=V-m,e[5]=1-A-O,e[6]=L+H,e[7]=0,e[8]=I+j,e[9]=L-H,e[10]=1-A-G,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var ct=Xt;function $n(){var e=new Rn(3);return Rn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Zt(e){var r=e[0],M=e[1],D=e[2];return Math.sqrt(r*r+M*M+D*D)}function xt(e,r,M){var D=new Rn(3);return D[0]=e,D[1]=r,D[2]=M,D}function Qn(e,r,M,D){return e[0]=r,e[1]=M,e[2]=D,e}function Ht(e,r,M){return e[0]=r[0]-M[0],e[1]=r[1]-M[1],e[2]=r[2]-M[2],e}function Zn(e,r){var M=r[0],D=r[1],E=r[2],S=M*M+D*D+E*E;return S>0&&(S=1/Math.sqrt(S)),e[0]=r[0]*S,e[1]=r[1]*S,e[2]=r[2]*S,e}function Qt(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function Hn(e,r,M){var D=r[0],E=r[1],S=r[2],_=M[0],z=M[1],U=M[2];return e[0]=E*U-S*z,e[1]=S*_-D*U,e[2]=D*z-E*_,e}var jt=Ht,Vt=Zt;(function(){var e=$n();return function(r,M,D,E,S,_){var z,U;for(M||(M=3),D||(D=0),E?U=Math.min(E*M+D,r.length):U=r.length,z=D;z<U;z+=M)e[0]=r[z],e[1]=r[z+1],e[2]=r[z+2],S(e,e,_),r[z]=e[0],r[z+1]=e[1],r[z+2]=e[2];return r}})();function mn(){var e=new Rn(4);return Rn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ot(e,r,M,D,E){return e[0]=r,e[1]=M,e[2]=D,e[3]=E,e}function ht(e,r){var M=r[0],D=r[1],E=r[2],S=r[3],_=M*M+D*D+E*E+S*S;return _>0&&(_=1/Math.sqrt(_)),e[0]=M*_,e[1]=D*_,e[2]=E*_,e[3]=S*_,e}function ft(e,r,M){var D=r[0],E=r[1],S=r[2],_=r[3];return e[0]=M[0]*D+M[4]*E+M[8]*S+M[12]*_,e[1]=M[1]*D+M[5]*E+M[9]*S+M[13]*_,e[2]=M[2]*D+M[6]*E+M[10]*S+M[14]*_,e[3]=M[3]*D+M[7]*E+M[11]*S+M[15]*_,e}(function(){var e=mn();return function(r,M,D,E,S,_){var z,U;for(M||(M=4),D||(D=0),E?U=Math.min(E*M+D,r.length):U=r.length,z=D;z<U;z+=M)e[0]=r[z],e[1]=r[z+1],e[2]=r[z+2],e[3]=r[z+3],S(e,e,_),r[z]=e[0],r[z+1]=e[1],r[z+2]=e[2],r[z+3]=e[3];return r}})();function Jn(){var e=new Rn(4);return Rn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function mt(e,r,M){M=M*.5;var D=Math.sin(M);return e[0]=D*r[0],e[1]=D*r[1],e[2]=D*r[2],e[3]=Math.cos(M),e}function Jt(e,r,M){var D=r[0],E=r[1],S=r[2],_=r[3],z=M[0],U=M[1],A=M[2],V=M[3];return e[0]=D*V+_*z+E*A-S*U,e[1]=E*V+_*U+S*z-D*A,e[2]=S*V+_*A+D*U-E*z,e[3]=_*V-D*z-E*U-S*A,e}function lt(e,r,M,D){var E=r[0],S=r[1],_=r[2],z=r[3],U=M[0],A=M[1],V=M[2],G=M[3],I,L,O,H,j;return L=E*U+S*A+_*V+z*G,L<0&&(L=-L,U=-U,A=-A,V=-V,G=-G),1-L>Lt?(I=Math.acos(L),O=Math.sin(I),H=Math.sin((1-D)*I)/O,j=Math.sin(D*I)/O):(H=1-D,j=D),e[0]=H*E+j*U,e[1]=H*S+j*A,e[2]=H*_+j*V,e[3]=H*z+j*G,e}function Gt(e,r){var M=r[0]+r[4]+r[8],D;if(M>0)D=Math.sqrt(M+1),e[3]=.5*D,D=.5/D,e[0]=(r[5]-r[7])*D,e[1]=(r[6]-r[2])*D,e[2]=(r[1]-r[3])*D;else{var E=0;r[4]>r[0]&&(E=1),r[8]>r[E*3+E]&&(E=2);var S=(E+1)%3,_=(E+2)%3;D=Math.sqrt(r[E*3+E]-r[S*3+S]-r[_*3+_]+1),e[E]=.5*D,D=.5/D,e[3]=(r[S*3+_]-r[_*3+S])*D,e[S]=(r[S*3+E]+r[E*3+S])*D,e[_]=(r[_*3+E]+r[E*3+_])*D}return e}var Et=ot,_t=Jt,dt=ht;(function(){var e=$n(),r=xt(1,0,0),M=xt(0,1,0);return function(D,E,S){var _=Qt(E,S);return _<-.999999?(Hn(e,r,E),Vt(e)<1e-6&&Hn(e,M,E),Zn(e,e),mt(D,e,Math.PI),D):_>.999999?(D[0]=0,D[1]=0,D[2]=0,D[3]=1,D):(Hn(e,E,S),D[0]=e[0],D[1]=e[1],D[2]=e[2],D[3]=1+_,dt(D,D))}})();(function(){var e=Jn(),r=Jn();return function(M,D,E,S,_,z){return lt(e,D,_,z),lt(r,E,S,z),lt(M,e,r,2*z*(1-z)),M}})();(function(){var e=Ot();return function(r,M,D,E){return e[0]=D[0],e[3]=D[1],e[6]=D[2],e[1]=E[0],e[4]=E[1],e[7]=E[2],e[2]=-M[0],e[5]=-M[1],e[8]=-M[2],dt(r,Gt(r,e))}})();function at(){var e=new Rn(2);return Rn!=Float32Array&&(e[0]=0,e[1]=0),e}function At(e,r,M){return e[0]=r,e[1]=M,e}function Kt(e,r){var M=r[0],D=r[1],E=M*M+D*D;return E>0&&(E=1/Math.sqrt(E)),e[0]=r[0]*E,e[1]=r[1]*E,e}function kt(e,r){return e[0]*r[0]+e[1]*r[1]}(function(){var e=at();return function(r,M,D,E,S,_){var z,U;for(M||(M=2),D||(D=0),E?U=Math.min(E*M+D,r.length):U=r.length,z=D;z<U;z+=M)e[0]=r[z],e[1]=r[z+1],S(e,e,_),r[z]=e[0],r[z+1]=e[1];return r}})();function zt(e){var r=kt(e,e);if(r<=1)return Et(Jn(),e[0],e[1],Math.sqrt(1-r),0);var M=Kt(at(),e);return Et(Jn(),M[0],M[1],0,0)}function rt(e,r,M){return e<r?r:e>M?M:e}class bt{constructor(r,M,D,E,S){var _=Qn($n(),r[0],r[1],r[2]),z=Qn($n(),M[0],M[1],M[2]),U=Qn($n(),D[0],D[1],D[2]);Zn(U,U);var A=jt($n(),z,_),V=Vt(A);Zn(A,A);var G=Hn($n(),A,U);Zn(G,G);var I=Hn($n(),G,A);Zn(I,I),Hn(G,A,I),Zn(G,G),this.zoomSpeed=E,this.invScreen=[1/S[0],1/S[1]],this.centerTranslation=st(Xn(),M),vt(this.centerTranslation,this.centerTranslation);var L=Qn($n(),0,0,-1*V);this.translation=st(Xn(),L);var O=$t(G[0],G[1],G[2],I[0],I[1],I[2],-A[0],-A[1],-A[2]);Nt(O,O),this.rotation=Gt(Jn(),O),dt(this.rotation,this.rotation),this.camera=Xn(),this.invCamera=Xn(),this.updateCameraMatrix()}rotate(r,M){var D=At(at(),rt(r[0]*2*this.invScreen[0]-1,-1,1),rt(1-r[1]*2*this.invScreen[1],-1,1)),E=At(at(),rt(M[0]*2*this.invScreen[0]-1,-1,1),rt(1-M[1]*2*this.invScreen[1],-1,1)),S=zt(D),_=zt(E);this.rotation=_t(this.rotation,S,this.rotation),this.rotation=_t(this.rotation,_,this.rotation),this.updateCameraMatrix()}zoom(r){var M=Qn($n(),0,0,r*this.invScreen[1]*this.zoomSpeed),D=st(Xn(),M);this.translation=ct(this.translation,D,this.translation),this.translation[14]>=-.2&&(this.translation[14]=-.2),this.updateCameraMatrix()}pan(r){var M=ot(mn(),r[0]*this.invScreen[0]*Math.abs(this.translation[14]),r[1]*this.invScreen[1]*Math.abs(this.translation[14]),0,0),D=ft(mn(),M,this.invCamera),E=st(Xn(),D);this.centerTranslation=ct(this.centerTranslation,E,this.centerTranslation),this.updateCameraMatrix()}updateCameraMatrix(){var r=Wt(Xn(),this.rotation);this.camera=ct(this.camera,r,this.centerTranslation),this.camera=ct(this.camera,this.translation,this.camera),this.invCamera=vt(this.invCamera,this.camera)}eyePos(){return[this.invCamera[12],this.invCamera[13],this.invCamera[14]]}eyeDir(){var r=ot(mn(),0,0,-1,0);return r=ft(r,r,this.invCamera),r=ht(r,r),[r[0],r[1],r[2]]}upDir(){var r=ot(mn(),0,1,0,0);return r=ft(r,r,this.invCamera),r=ht(r,r),[r[0],r[1],r[2]]}}function Bt(e,r){var M=[r[0]-e[0],r[1]-e[1]];return Math.sqrt(Math.pow(M[0],2)+Math.pow(M[1],2))}class Ct{constructor(){this.mousemove=null,this.press=null,this.wheel=null,this.twoFingerDrag=null,this.pinch=null}registerForCanvas(r){var M=null,D=this;r.addEventListener("mousemove",function(_){_.preventDefault();var z=r.getBoundingClientRect(),U=[_.clientX-z.left,_.clientY-z.top];M?D.mousemove&&D.mousemove(M,U,_):M=[_.clientX-z.left,_.clientY-z.top],M=U}),r.addEventListener("mousedown",function(_){_.preventDefault();var z=r.getBoundingClientRect(),U=[_.clientX-z.left,_.clientY-z.top];D.press&&D.press(U,_)}),r.addEventListener("wheel",function(_){_.preventDefault(),D.wheel&&D.wheel(-_.deltaY)}),r.oncontextmenu=function(_){_.preventDefault()};var E={};r.addEventListener("touchstart",function(_){var z=r.getBoundingClientRect();_.preventDefault();for(var U=0;U<_.changedTouches.length;++U){var A=_.changedTouches[U];E[A.identifier]=[A.clientX-z.left,A.clientY-z.top],_.changedTouches.length==1&&D.press&&D.press(E[A.identifier],_)}}),r.addEventListener("touchmove",function(_){_.preventDefault();var z=r.getBoundingClientRect(),U=Object.keys(E).length;if(U==1){if(D.mousemove){var A=_.changedTouches[0],V=E[A.identifier],G=[A.clientX-z.left,A.clientY-z.top];_.buttons=1,D.mousemove(V,G,_)}}else{for(var I={},L=0;L<_.changedTouches.length;++L){var A=_.changedTouches[L];I[A.identifier]=[A.clientX-z.left,A.clientY-z.top]}var O=[];for(A in E)A in I||(I[A]=E[A]),O.push(E[A]);var H=[];for(A in I)H.push(I[A]);var j=[vec2.set(vec2.create(),H[0][0]-O[0][0],H[0][1]-O[0][1]),vec2.set(vec2.create(),H[1][0]-O[1][0],H[1][1]-O[1][1])],m=[vec2.create(),vec2.create()];vec2.normalize(m[0],j[0]),vec2.normalize(m[1],j[1]);var J=vec2.set(vec2.create(),O[1][0]-O[0][0],O[1][1]-O[0][1]);vec2.normalize(J,J);var $=vec2.lerp(vec2.create(),j[0],j[1],.5);vec2.normalize($,$);var Q=[vec2.dot(J,m[0]),vec2.dot(J,m[1])],Y=[vec2.dot($,m[0]),vec2.dot($,m[1])];if(D.pinch&&Math.abs(Q[0])>.5&&Math.abs(Q[1])>.5&&Math.sign(Q[0])!=Math.sign(Q[1])){var Z=Bt(O[0],O[1]),fn=Bt(H[0],H[1]);D.pinch(fn-Z)}else if(D.twoFingerDrag&&Math.abs(Y[0])>.5&&Math.abs(Y[1])>.5&&Math.sign(Y[0])==Math.sign(Y[1])){var cn=vec2.lerp(vec2.create(),j[0],j[1],.5);cn[1]=-cn[1],D.twoFingerDrag(cn)}}for(var L=0;L<_.changedTouches.length;++L){var A=_.changedTouches[L];E[A.identifier]=[A.clientX-z.left,A.clientY-z.top]}});var S=function(_){_.preventDefault();for(var z=0;z<_.changedTouches.length;++z){var U=_.changedTouches[z];delete E[U.identifier]}};r.addEventListener("touchcancel",S),r.addEventListener("touchend",S)}}function ne(e,r){return class extends e{constructor(...M){super(...M),r(this)}}}const te=ne(Array,e=>e.fill(0));let k=1e-6;function ee(e){function r(p=0,y=0){const g=new e(2);return p!==void 0&&(g[0]=p,y!==void 0&&(g[1]=y)),g}const M=r;function D(p,y,g){const n=g??new e(2);return n[0]=p,n[1]=y,n}function E(p,y){const g=y??new e(2);return g[0]=Math.ceil(p[0]),g[1]=Math.ceil(p[1]),g}function S(p,y){const g=y??new e(2);return g[0]=Math.floor(p[0]),g[1]=Math.floor(p[1]),g}function _(p,y){const g=y??new e(2);return g[0]=Math.round(p[0]),g[1]=Math.round(p[1]),g}function z(p,y=0,g=1,n){const f=n??new e(2);return f[0]=Math.min(g,Math.max(y,p[0])),f[1]=Math.min(g,Math.max(y,p[1])),f}function U(p,y,g){const n=g??new e(2);return n[0]=p[0]+y[0],n[1]=p[1]+y[1],n}function A(p,y,g,n){const f=n??new e(2);return f[0]=p[0]+y[0]*g,f[1]=p[1]+y[1]*g,f}function V(p,y){const g=p[0],n=p[1],f=y[0],c=y[1],i=Math.sqrt(g*g+n*n),s=Math.sqrt(f*f+c*c),a=i*s,d=a&&en(p,y)/a;return Math.acos(d)}function G(p,y,g){const n=g??new e(2);return n[0]=p[0]-y[0],n[1]=p[1]-y[1],n}const I=G;function L(p,y){return Math.abs(p[0]-y[0])<k&&Math.abs(p[1]-y[1])<k}function O(p,y){return p[0]===y[0]&&p[1]===y[1]}function H(p,y,g,n){const f=n??new e(2);return f[0]=p[0]+g*(y[0]-p[0]),f[1]=p[1]+g*(y[1]-p[1]),f}function j(p,y,g,n){const f=n??new e(2);return f[0]=p[0]+g[0]*(y[0]-p[0]),f[1]=p[1]+g[1]*(y[1]-p[1]),f}function m(p,y,g){const n=g??new e(2);return n[0]=Math.max(p[0],y[0]),n[1]=Math.max(p[1],y[1]),n}function J(p,y,g){const n=g??new e(2);return n[0]=Math.min(p[0],y[0]),n[1]=Math.min(p[1],y[1]),n}function $(p,y,g){const n=g??new e(2);return n[0]=p[0]*y,n[1]=p[1]*y,n}const Q=$;function Y(p,y,g){const n=g??new e(2);return n[0]=p[0]/y,n[1]=p[1]/y,n}function Z(p,y){const g=y??new e(2);return g[0]=1/p[0],g[1]=1/p[1],g}const fn=Z;function cn(p,y,g){const n=g??new e(3),f=p[0]*y[1]-p[1]*y[0];return n[0]=0,n[1]=0,n[2]=f,n}function en(p,y){return p[0]*y[0]+p[1]*y[1]}function b(p){const y=p[0],g=p[1];return Math.sqrt(y*y+g*g)}const an=b;function ln(p){const y=p[0],g=p[1];return y*y+g*g}const hn=ln;function nn(p,y){const g=p[0]-y[0],n=p[1]-y[1];return Math.sqrt(g*g+n*n)}const tn=nn;function sn(p,y){const g=p[0]-y[0],n=p[1]-y[1];return g*g+n*n}const C=sn;function yn(p,y){const g=y??new e(2),n=p[0],f=p[1],c=Math.sqrt(n*n+f*f);return c>1e-5?(g[0]=n/c,g[1]=f/c):(g[0]=0,g[1]=0),g}function wn(p,y){const g=y??new e(2);return g[0]=-p[0],g[1]=-p[1],g}function un(p,y){const g=y??new e(2);return g[0]=p[0],g[1]=p[1],g}const Bn=un;function gn(p,y,g){const n=g??new e(2);return n[0]=p[0]*y[0],n[1]=p[1]*y[1],n}const On=gn;function Fn(p,y,g){const n=g??new e(2);return n[0]=p[0]/y[0],n[1]=p[1]/y[1],n}const Yn=Fn;function In(p=1,y){const g=y??new e(2),n=Math.random()*2*Math.PI;return g[0]=Math.cos(n)*p,g[1]=Math.sin(n)*p,g}function v(p){const y=p??new e(2);return y[0]=0,y[1]=0,y}function T(p,y,g){const n=g??new e(2),f=p[0],c=p[1];return n[0]=f*y[0]+c*y[4]+y[12],n[1]=f*y[1]+c*y[5]+y[13],n}function w(p,y,g){const n=g??new e(2),f=p[0],c=p[1];return n[0]=y[0]*f+y[4]*c+y[8],n[1]=y[1]*f+y[5]*c+y[9],n}function t(p,y,g,n){const f=n??new e(2),c=p[0]-y[0],i=p[1]-y[1],s=Math.sin(g),a=Math.cos(g);return f[0]=c*a-i*s+y[0],f[1]=c*s+i*a+y[1],f}function u(p,y,g){const n=g??new e(2);return yn(p,n),$(n,y,n)}function o(p,y,g){const n=g??new e(2);return b(p)>y?u(p,y,n):un(p,n)}function l(p,y,g){const n=g??new e(2);return H(p,y,.5,n)}return{create:r,fromValues:M,set:D,ceil:E,floor:S,round:_,clamp:z,add:U,addScaled:A,angle:V,subtract:G,sub:I,equalsApproximately:L,equals:O,lerp:H,lerpV:j,max:m,min:J,mulScalar:$,scale:Q,divScalar:Y,inverse:Z,invert:fn,cross:cn,dot:en,length:b,len:an,lengthSq:ln,lenSq:hn,distance:nn,dist:tn,distanceSq:sn,distSq:C,normalize:yn,negate:wn,copy:un,clone:Bn,multiply:gn,mul:On,divide:Fn,div:Yn,random:In,zero:v,transformMat4:T,transformMat3:w,rotate:t,setLength:u,truncate:o,midpoint:l}}const Pt=new Map;function Yt(e){let r=Pt.get(e);return r||(r=ee(e),Pt.set(e,r)),r}function se(e){function r(s,a,d){const h=new e(3);return s!==void 0&&(h[0]=s,a!==void 0&&(h[1]=a,d!==void 0&&(h[2]=d))),h}const M=r;function D(s,a,d,h){const x=h??new e(3);return x[0]=s,x[1]=a,x[2]=d,x}function E(s,a){const d=a??new e(3);return d[0]=Math.ceil(s[0]),d[1]=Math.ceil(s[1]),d[2]=Math.ceil(s[2]),d}function S(s,a){const d=a??new e(3);return d[0]=Math.floor(s[0]),d[1]=Math.floor(s[1]),d[2]=Math.floor(s[2]),d}function _(s,a){const d=a??new e(3);return d[0]=Math.round(s[0]),d[1]=Math.round(s[1]),d[2]=Math.round(s[2]),d}function z(s,a=0,d=1,h){const x=h??new e(3);return x[0]=Math.min(d,Math.max(a,s[0])),x[1]=Math.min(d,Math.max(a,s[1])),x[2]=Math.min(d,Math.max(a,s[2])),x}function U(s,a,d){const h=d??new e(3);return h[0]=s[0]+a[0],h[1]=s[1]+a[1],h[2]=s[2]+a[2],h}function A(s,a,d,h){const x=h??new e(3);return x[0]=s[0]+a[0]*d,x[1]=s[1]+a[1]*d,x[2]=s[2]+a[2]*d,x}function V(s,a){const d=s[0],h=s[1],x=s[2],B=a[0],P=a[1],q=a[2],F=Math.sqrt(d*d+h*h+x*x),R=Math.sqrt(B*B+P*P+q*q),N=F*R,K=N&&en(s,a)/N;return Math.acos(K)}function G(s,a,d){const h=d??new e(3);return h[0]=s[0]-a[0],h[1]=s[1]-a[1],h[2]=s[2]-a[2],h}const I=G;function L(s,a){return Math.abs(s[0]-a[0])<k&&Math.abs(s[1]-a[1])<k&&Math.abs(s[2]-a[2])<k}function O(s,a){return s[0]===a[0]&&s[1]===a[1]&&s[2]===a[2]}function H(s,a,d,h){const x=h??new e(3);return x[0]=s[0]+d*(a[0]-s[0]),x[1]=s[1]+d*(a[1]-s[1]),x[2]=s[2]+d*(a[2]-s[2]),x}function j(s,a,d,h){const x=h??new e(3);return x[0]=s[0]+d[0]*(a[0]-s[0]),x[1]=s[1]+d[1]*(a[1]-s[1]),x[2]=s[2]+d[2]*(a[2]-s[2]),x}function m(s,a,d){const h=d??new e(3);return h[0]=Math.max(s[0],a[0]),h[1]=Math.max(s[1],a[1]),h[2]=Math.max(s[2],a[2]),h}function J(s,a,d){const h=d??new e(3);return h[0]=Math.min(s[0],a[0]),h[1]=Math.min(s[1],a[1]),h[2]=Math.min(s[2],a[2]),h}function $(s,a,d){const h=d??new e(3);return h[0]=s[0]*a,h[1]=s[1]*a,h[2]=s[2]*a,h}const Q=$;function Y(s,a,d){const h=d??new e(3);return h[0]=s[0]/a,h[1]=s[1]/a,h[2]=s[2]/a,h}function Z(s,a){const d=a??new e(3);return d[0]=1/s[0],d[1]=1/s[1],d[2]=1/s[2],d}const fn=Z;function cn(s,a,d){const h=d??new e(3),x=s[2]*a[0]-s[0]*a[2],B=s[0]*a[1]-s[1]*a[0];return h[0]=s[1]*a[2]-s[2]*a[1],h[1]=x,h[2]=B,h}function en(s,a){return s[0]*a[0]+s[1]*a[1]+s[2]*a[2]}function b(s){const a=s[0],d=s[1],h=s[2];return Math.sqrt(a*a+d*d+h*h)}const an=b;function ln(s){const a=s[0],d=s[1],h=s[2];return a*a+d*d+h*h}const hn=ln;function nn(s,a){const d=s[0]-a[0],h=s[1]-a[1],x=s[2]-a[2];return Math.sqrt(d*d+h*h+x*x)}const tn=nn;function sn(s,a){const d=s[0]-a[0],h=s[1]-a[1],x=s[2]-a[2];return d*d+h*h+x*x}const C=sn;function yn(s,a){const d=a??new e(3),h=s[0],x=s[1],B=s[2],P=Math.sqrt(h*h+x*x+B*B);return P>1e-5?(d[0]=h/P,d[1]=x/P,d[2]=B/P):(d[0]=0,d[1]=0,d[2]=0),d}function wn(s,a){const d=a??new e(3);return d[0]=-s[0],d[1]=-s[1],d[2]=-s[2],d}function un(s,a){const d=a??new e(3);return d[0]=s[0],d[1]=s[1],d[2]=s[2],d}const Bn=un;function gn(s,a,d){const h=d??new e(3);return h[0]=s[0]*a[0],h[1]=s[1]*a[1],h[2]=s[2]*a[2],h}const On=gn;function Fn(s,a,d){const h=d??new e(3);return h[0]=s[0]/a[0],h[1]=s[1]/a[1],h[2]=s[2]/a[2],h}const Yn=Fn;function In(s=1,a){const d=a??new e(3),h=Math.random()*2*Math.PI,x=Math.random()*2-1,B=Math.sqrt(1-x*x)*s;return d[0]=Math.cos(h)*B,d[1]=Math.sin(h)*B,d[2]=x*s,d}function v(s){const a=s??new e(3);return a[0]=0,a[1]=0,a[2]=0,a}function T(s,a,d){const h=d??new e(3),x=s[0],B=s[1],P=s[2],q=a[3]*x+a[7]*B+a[11]*P+a[15]||1;return h[0]=(a[0]*x+a[4]*B+a[8]*P+a[12])/q,h[1]=(a[1]*x+a[5]*B+a[9]*P+a[13])/q,h[2]=(a[2]*x+a[6]*B+a[10]*P+a[14])/q,h}function w(s,a,d){const h=d??new e(3),x=s[0],B=s[1],P=s[2];return h[0]=x*a[0]+B*a[4]+P*a[8],h[1]=x*a[1]+B*a[5]+P*a[9],h[2]=x*a[2]+B*a[6]+P*a[10],h}function t(s,a,d){const h=d??new e(3),x=s[0],B=s[1],P=s[2];return h[0]=x*a[0]+B*a[4]+P*a[8],h[1]=x*a[1]+B*a[5]+P*a[9],h[2]=x*a[2]+B*a[6]+P*a[10],h}function u(s,a,d){const h=d??new e(3),x=a[0],B=a[1],P=a[2],q=a[3]*2,F=s[0],R=s[1],N=s[2],K=B*N-P*R,X=P*F-x*N,W=x*R-B*F;return h[0]=F+K*q+(B*W-P*X)*2,h[1]=R+X*q+(P*K-x*W)*2,h[2]=N+W*q+(x*X-B*K)*2,h}function o(s,a){const d=a??new e(3);return d[0]=s[12],d[1]=s[13],d[2]=s[14],d}function l(s,a,d){const h=d??new e(3),x=a*4;return h[0]=s[x+0],h[1]=s[x+1],h[2]=s[x+2],h}function p(s,a){const d=a??new e(3),h=s[0],x=s[1],B=s[2],P=s[4],q=s[5],F=s[6],R=s[8],N=s[9],K=s[10];return d[0]=Math.sqrt(h*h+x*x+B*B),d[1]=Math.sqrt(P*P+q*q+F*F),d[2]=Math.sqrt(R*R+N*N+K*K),d}function y(s,a,d,h){const x=h??new e(3),B=[],P=[];return B[0]=s[0]-a[0],B[1]=s[1]-a[1],B[2]=s[2]-a[2],P[0]=B[0],P[1]=B[1]*Math.cos(d)-B[2]*Math.sin(d),P[2]=B[1]*Math.sin(d)+B[2]*Math.cos(d),x[0]=P[0]+a[0],x[1]=P[1]+a[1],x[2]=P[2]+a[2],x}function g(s,a,d,h){const x=h??new e(3),B=[],P=[];return B[0]=s[0]-a[0],B[1]=s[1]-a[1],B[2]=s[2]-a[2],P[0]=B[2]*Math.sin(d)+B[0]*Math.cos(d),P[1]=B[1],P[2]=B[2]*Math.cos(d)-B[0]*Math.sin(d),x[0]=P[0]+a[0],x[1]=P[1]+a[1],x[2]=P[2]+a[2],x}function n(s,a,d,h){const x=h??new e(3),B=[],P=[];return B[0]=s[0]-a[0],B[1]=s[1]-a[1],B[2]=s[2]-a[2],P[0]=B[0]*Math.cos(d)-B[1]*Math.sin(d),P[1]=B[0]*Math.sin(d)+B[1]*Math.cos(d),P[2]=B[2],x[0]=P[0]+a[0],x[1]=P[1]+a[1],x[2]=P[2]+a[2],x}function f(s,a,d){const h=d??new e(3);return yn(s,h),$(h,a,h)}function c(s,a,d){const h=d??new e(3);return b(s)>a?f(s,a,h):un(s,h)}function i(s,a,d){const h=d??new e(3);return H(s,a,.5,h)}return{create:r,fromValues:M,set:D,ceil:E,floor:S,round:_,clamp:z,add:U,addScaled:A,angle:V,subtract:G,sub:I,equalsApproximately:L,equals:O,lerp:H,lerpV:j,max:m,min:J,mulScalar:$,scale:Q,divScalar:Y,inverse:Z,invert:fn,cross:cn,dot:en,length:b,len:an,lengthSq:ln,lenSq:hn,distance:nn,dist:tn,distanceSq:sn,distSq:C,normalize:yn,negate:wn,copy:un,clone:Bn,multiply:gn,mul:On,divide:Fn,div:Yn,random:In,zero:v,transformMat4:T,transformMat4Upper3x3:w,transformMat3:t,transformQuat:u,getTranslation:o,getAxis:l,getScaling:p,rotateX:y,rotateY:g,rotateZ:n,setLength:f,truncate:c,midpoint:i}}const St=new Map;function ut(e){let r=St.get(e);return r||(r=se(e),St.set(e,r)),r}function ce(e){const r=Yt(e),M=ut(e);function D(t,u,o,l,p,y,g,n,f){const c=new e(12);return c[3]=0,c[7]=0,c[11]=0,t!==void 0&&(c[0]=t,u!==void 0&&(c[1]=u,o!==void 0&&(c[2]=o,l!==void 0&&(c[4]=l,p!==void 0&&(c[5]=p,y!==void 0&&(c[6]=y,g!==void 0&&(c[8]=g,n!==void 0&&(c[9]=n,f!==void 0&&(c[10]=f))))))))),c}function E(t,u,o,l,p,y,g,n,f,c){const i=c??new e(12);return i[0]=t,i[1]=u,i[2]=o,i[3]=0,i[4]=l,i[5]=p,i[6]=y,i[7]=0,i[8]=g,i[9]=n,i[10]=f,i[11]=0,i}function S(t,u){const o=u??new e(12);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=0,o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=0,o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=0,o}function _(t,u){const o=u??new e(12),l=t[0],p=t[1],y=t[2],g=t[3],n=l+l,f=p+p,c=y+y,i=l*n,s=p*n,a=p*f,d=y*n,h=y*f,x=y*c,B=g*n,P=g*f,q=g*c;return o[0]=1-a-x,o[1]=s+q,o[2]=d-P,o[3]=0,o[4]=s-q,o[5]=1-i-x,o[6]=h+B,o[7]=0,o[8]=d+P,o[9]=h-B,o[10]=1-i-a,o[11]=0,o}function z(t,u){const o=u??new e(12);return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o[4]=-t[4],o[5]=-t[5],o[6]=-t[6],o[8]=-t[8],o[9]=-t[9],o[10]=-t[10],o}function U(t,u,o){const l=o??new e(12);return l[0]=t[0]*u,l[1]=t[1]*u,l[2]=t[2]*u,l[4]=t[4]*u,l[5]=t[5]*u,l[6]=t[6]*u,l[8]=t[8]*u,l[9]=t[9]*u,l[10]=t[10]*u,l}const A=U;function V(t,u,o){const l=o??new e(12);return l[0]=t[0]+u[0],l[1]=t[1]+u[1],l[2]=t[2]+u[2],l[4]=t[4]+u[4],l[5]=t[5]+u[5],l[6]=t[6]+u[6],l[8]=t[8]+u[8],l[9]=t[9]+u[9],l[10]=t[10]+u[10],l}function G(t,u){const o=u??new e(12);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[8]=t[8],o[9]=t[9],o[10]=t[10],o}const I=G;function L(t,u){return Math.abs(t[0]-u[0])<k&&Math.abs(t[1]-u[1])<k&&Math.abs(t[2]-u[2])<k&&Math.abs(t[4]-u[4])<k&&Math.abs(t[5]-u[5])<k&&Math.abs(t[6]-u[6])<k&&Math.abs(t[8]-u[8])<k&&Math.abs(t[9]-u[9])<k&&Math.abs(t[10]-u[10])<k}function O(t,u){return t[0]===u[0]&&t[1]===u[1]&&t[2]===u[2]&&t[4]===u[4]&&t[5]===u[5]&&t[6]===u[6]&&t[8]===u[8]&&t[9]===u[9]&&t[10]===u[10]}function H(t){const u=t??new e(12);return u[0]=1,u[1]=0,u[2]=0,u[4]=0,u[5]=1,u[6]=0,u[8]=0,u[9]=0,u[10]=1,u}function j(t,u){const o=u??new e(12);if(o===t){let a;return a=t[1],t[1]=t[4],t[4]=a,a=t[2],t[2]=t[8],t[8]=a,a=t[6],t[6]=t[9],t[9]=a,o}const l=t[0],p=t[1],y=t[2],g=t[4],n=t[5],f=t[6],c=t[8],i=t[9],s=t[10];return o[0]=l,o[1]=g,o[2]=c,o[4]=p,o[5]=n,o[6]=i,o[8]=y,o[9]=f,o[10]=s,o}function m(t,u){const o=u??new e(12),l=t[0],p=t[1],y=t[2],g=t[4],n=t[5],f=t[6],c=t[8],i=t[9],s=t[10],a=s*n-f*i,d=-s*g+f*c,h=i*g-n*c,x=1/(l*a+p*d+y*h);return o[0]=a*x,o[1]=(-s*p+y*i)*x,o[2]=(f*p-y*n)*x,o[4]=d*x,o[5]=(s*l-y*c)*x,o[6]=(-f*l+y*g)*x,o[8]=h*x,o[9]=(-i*l+p*c)*x,o[10]=(n*l-p*g)*x,o}function J(t){const u=t[0],o=t[1],l=t[2],p=t[4],y=t[5],g=t[6],n=t[8],f=t[9],c=t[10];return u*(y*c-f*g)-p*(o*c-f*l)+n*(o*g-y*l)}const $=m;function Q(t,u,o){const l=o??new e(12),p=t[0],y=t[1],g=t[2],n=t[4],f=t[5],c=t[6],i=t[8],s=t[9],a=t[10],d=u[0],h=u[1],x=u[2],B=u[4],P=u[5],q=u[6],F=u[8],R=u[9],N=u[10];return l[0]=p*d+n*h+i*x,l[1]=y*d+f*h+s*x,l[2]=g*d+c*h+a*x,l[4]=p*B+n*P+i*q,l[5]=y*B+f*P+s*q,l[6]=g*B+c*P+a*q,l[8]=p*F+n*R+i*N,l[9]=y*F+f*R+s*N,l[10]=g*F+c*R+a*N,l}const Y=Q;function Z(t,u,o){const l=o??H();return t!==l&&(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[4]=t[4],l[5]=t[5],l[6]=t[6]),l[8]=u[0],l[9]=u[1],l[10]=1,l}function fn(t,u){const o=u??r.create();return o[0]=t[8],o[1]=t[9],o}function cn(t,u,o){const l=o??r.create(),p=u*4;return l[0]=t[p+0],l[1]=t[p+1],l}function en(t,u,o,l){const p=l===t?t:G(t,l),y=o*4;return p[y+0]=u[0],p[y+1]=u[1],p}function b(t,u){const o=u??r.create(),l=t[0],p=t[1],y=t[4],g=t[5];return o[0]=Math.sqrt(l*l+p*p),o[1]=Math.sqrt(y*y+g*g),o}function an(t,u){const o=u??M.create(),l=t[0],p=t[1],y=t[2],g=t[4],n=t[5],f=t[6],c=t[8],i=t[9],s=t[10];return o[0]=Math.sqrt(l*l+p*p+y*y),o[1]=Math.sqrt(g*g+n*n+f*f),o[2]=Math.sqrt(c*c+i*i+s*s),o}function ln(t,u){const o=u??new e(12);return o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=1,o[6]=0,o[8]=t[0],o[9]=t[1],o[10]=1,o}function hn(t,u,o){const l=o??new e(12),p=u[0],y=u[1],g=t[0],n=t[1],f=t[2],c=t[4],i=t[5],s=t[6],a=t[8],d=t[9],h=t[10];return t!==l&&(l[0]=g,l[1]=n,l[2]=f,l[4]=c,l[5]=i,l[6]=s),l[8]=g*p+c*y+a,l[9]=n*p+i*y+d,l[10]=f*p+s*y+h,l}function nn(t,u){const o=u??new e(12),l=Math.cos(t),p=Math.sin(t);return o[0]=l,o[1]=p,o[2]=0,o[4]=-p,o[5]=l,o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function tn(t,u,o){const l=o??new e(12),p=t[0],y=t[1],g=t[2],n=t[4],f=t[5],c=t[6],i=Math.cos(u),s=Math.sin(u);return l[0]=i*p+s*n,l[1]=i*y+s*f,l[2]=i*g+s*c,l[4]=i*n-s*p,l[5]=i*f-s*y,l[6]=i*c-s*g,t!==l&&(l[8]=t[8],l[9]=t[9],l[10]=t[10]),l}function sn(t,u){const o=u??new e(12),l=Math.cos(t),p=Math.sin(t);return o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=l,o[6]=p,o[8]=0,o[9]=-p,o[10]=l,o}function C(t,u,o){const l=o??new e(12),p=t[4],y=t[5],g=t[6],n=t[8],f=t[9],c=t[10],i=Math.cos(u),s=Math.sin(u);return l[4]=i*p+s*n,l[5]=i*y+s*f,l[6]=i*g+s*c,l[8]=i*n-s*p,l[9]=i*f-s*y,l[10]=i*c-s*g,t!==l&&(l[0]=t[0],l[1]=t[1],l[2]=t[2]),l}function yn(t,u){const o=u??new e(12),l=Math.cos(t),p=Math.sin(t);return o[0]=l,o[1]=0,o[2]=-p,o[4]=0,o[5]=1,o[6]=0,o[8]=p,o[9]=0,o[10]=l,o}function wn(t,u,o){const l=o??new e(12),p=t[0],y=t[1],g=t[2],n=t[8],f=t[9],c=t[10],i=Math.cos(u),s=Math.sin(u);return l[0]=i*p-s*n,l[1]=i*y-s*f,l[2]=i*g-s*c,l[8]=i*n+s*p,l[9]=i*f+s*y,l[10]=i*c+s*g,t!==l&&(l[4]=t[4],l[5]=t[5],l[6]=t[6]),l}const un=nn,Bn=tn;function gn(t,u){const o=u??new e(12);return o[0]=t[0],o[1]=0,o[2]=0,o[4]=0,o[5]=t[1],o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function On(t,u,o){const l=o??new e(12),p=u[0],y=u[1];return l[0]=p*t[0],l[1]=p*t[1],l[2]=p*t[2],l[4]=y*t[4],l[5]=y*t[5],l[6]=y*t[6],t!==l&&(l[8]=t[8],l[9]=t[9],l[10]=t[10]),l}function Fn(t,u){const o=u??new e(12);return o[0]=t[0],o[1]=0,o[2]=0,o[4]=0,o[5]=t[1],o[6]=0,o[8]=0,o[9]=0,o[10]=t[2],o}function Yn(t,u,o){const l=o??new e(12),p=u[0],y=u[1],g=u[2];return l[0]=p*t[0],l[1]=p*t[1],l[2]=p*t[2],l[4]=y*t[4],l[5]=y*t[5],l[6]=y*t[6],l[8]=g*t[8],l[9]=g*t[9],l[10]=g*t[10],l}function In(t,u){const o=u??new e(12);return o[0]=t,o[1]=0,o[2]=0,o[4]=0,o[5]=t,o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function v(t,u,o){const l=o??new e(12);return l[0]=u*t[0],l[1]=u*t[1],l[2]=u*t[2],l[4]=u*t[4],l[5]=u*t[5],l[6]=u*t[6],t!==l&&(l[8]=t[8],l[9]=t[9],l[10]=t[10]),l}function T(t,u){const o=u??new e(12);return o[0]=t,o[1]=0,o[2]=0,o[4]=0,o[5]=t,o[6]=0,o[8]=0,o[9]=0,o[10]=t,o}function w(t,u,o){const l=o??new e(12);return l[0]=u*t[0],l[1]=u*t[1],l[2]=u*t[2],l[4]=u*t[4],l[5]=u*t[5],l[6]=u*t[6],l[8]=u*t[8],l[9]=u*t[9],l[10]=u*t[10],l}return{add:V,clone:I,copy:G,create:D,determinant:J,equals:O,equalsApproximately:L,fromMat4:S,fromQuat:_,get3DScaling:an,getAxis:cn,getScaling:b,getTranslation:fn,identity:H,inverse:m,invert:$,mul:Y,mulScalar:A,multiply:Q,multiplyScalar:U,negate:z,rotate:tn,rotateX:C,rotateY:wn,rotateZ:Bn,rotation:nn,rotationX:sn,rotationY:yn,rotationZ:un,scale:On,scale3D:Yn,scaling:gn,scaling3D:Fn,set:E,setAxis:en,setTranslation:Z,translate:hn,translation:ln,transpose:j,uniformScale:v,uniformScale3D:w,uniformScaling:In,uniformScaling3D:T}}const Tt=new Map;function re(e){let r=Tt.get(e);return r||(r=ce(e),Tt.set(e,r)),r}function oe(e){const r=ut(e);function M(n,f,c,i,s,a,d,h,x,B,P,q,F,R,N,K){const X=new e(16);return n!==void 0&&(X[0]=n,f!==void 0&&(X[1]=f,c!==void 0&&(X[2]=c,i!==void 0&&(X[3]=i,s!==void 0&&(X[4]=s,a!==void 0&&(X[5]=a,d!==void 0&&(X[6]=d,h!==void 0&&(X[7]=h,x!==void 0&&(X[8]=x,B!==void 0&&(X[9]=B,P!==void 0&&(X[10]=P,q!==void 0&&(X[11]=q,F!==void 0&&(X[12]=F,R!==void 0&&(X[13]=R,N!==void 0&&(X[14]=N,K!==void 0&&(X[15]=K)))))))))))))))),X}function D(n,f,c,i,s,a,d,h,x,B,P,q,F,R,N,K,X){const W=X??new e(16);return W[0]=n,W[1]=f,W[2]=c,W[3]=i,W[4]=s,W[5]=a,W[6]=d,W[7]=h,W[8]=x,W[9]=B,W[10]=P,W[11]=q,W[12]=F,W[13]=R,W[14]=N,W[15]=K,W}function E(n,f){const c=f??new e(16);return c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=0,c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=0,c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function S(n,f){const c=f??new e(16),i=n[0],s=n[1],a=n[2],d=n[3],h=i+i,x=s+s,B=a+a,P=i*h,q=s*h,F=s*x,R=a*h,N=a*x,K=a*B,X=d*h,W=d*x,on=d*B;return c[0]=1-F-K,c[1]=q+on,c[2]=R-W,c[3]=0,c[4]=q-on,c[5]=1-P-K,c[6]=N+X,c[7]=0,c[8]=R+W,c[9]=N-X,c[10]=1-P-F,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function _(n,f){const c=f??new e(16);return c[0]=-n[0],c[1]=-n[1],c[2]=-n[2],c[3]=-n[3],c[4]=-n[4],c[5]=-n[5],c[6]=-n[6],c[7]=-n[7],c[8]=-n[8],c[9]=-n[9],c[10]=-n[10],c[11]=-n[11],c[12]=-n[12],c[13]=-n[13],c[14]=-n[14],c[15]=-n[15],c}function z(n,f,c){const i=c??new e(16);return i[0]=n[0]+f[0],i[1]=n[1]+f[1],i[2]=n[2]+f[2],i[3]=n[3]+f[3],i[4]=n[4]+f[4],i[5]=n[5]+f[5],i[6]=n[6]+f[6],i[7]=n[7]+f[7],i[8]=n[8]+f[8],i[9]=n[9]+f[9],i[10]=n[10]+f[10],i[11]=n[11]+f[11],i[12]=n[12]+f[12],i[13]=n[13]+f[13],i[14]=n[14]+f[14],i[15]=n[15]+f[15],i}function U(n,f,c){const i=c??new e(16);return i[0]=n[0]*f,i[1]=n[1]*f,i[2]=n[2]*f,i[3]=n[3]*f,i[4]=n[4]*f,i[5]=n[5]*f,i[6]=n[6]*f,i[7]=n[7]*f,i[8]=n[8]*f,i[9]=n[9]*f,i[10]=n[10]*f,i[11]=n[11]*f,i[12]=n[12]*f,i[13]=n[13]*f,i[14]=n[14]*f,i[15]=n[15]*f,i}const A=U;function V(n,f){const c=f??new e(16);return c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c}const G=V;function I(n,f){return Math.abs(n[0]-f[0])<k&&Math.abs(n[1]-f[1])<k&&Math.abs(n[2]-f[2])<k&&Math.abs(n[3]-f[3])<k&&Math.abs(n[4]-f[4])<k&&Math.abs(n[5]-f[5])<k&&Math.abs(n[6]-f[6])<k&&Math.abs(n[7]-f[7])<k&&Math.abs(n[8]-f[8])<k&&Math.abs(n[9]-f[9])<k&&Math.abs(n[10]-f[10])<k&&Math.abs(n[11]-f[11])<k&&Math.abs(n[12]-f[12])<k&&Math.abs(n[13]-f[13])<k&&Math.abs(n[14]-f[14])<k&&Math.abs(n[15]-f[15])<k}function L(n,f){return n[0]===f[0]&&n[1]===f[1]&&n[2]===f[2]&&n[3]===f[3]&&n[4]===f[4]&&n[5]===f[5]&&n[6]===f[6]&&n[7]===f[7]&&n[8]===f[8]&&n[9]===f[9]&&n[10]===f[10]&&n[11]===f[11]&&n[12]===f[12]&&n[13]===f[13]&&n[14]===f[14]&&n[15]===f[15]}function O(n){const f=n??new e(16);return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function H(n,f){const c=f??new e(16);if(c===n){let rn;return rn=n[1],n[1]=n[4],n[4]=rn,rn=n[2],n[2]=n[8],n[8]=rn,rn=n[3],n[3]=n[12],n[12]=rn,rn=n[6],n[6]=n[9],n[9]=rn,rn=n[7],n[7]=n[13],n[13]=rn,rn=n[11],n[11]=n[14],n[14]=rn,c}const i=n[0],s=n[1],a=n[2],d=n[3],h=n[4],x=n[5],B=n[6],P=n[7],q=n[8],F=n[9],R=n[10],N=n[11],K=n[12],X=n[13],W=n[14],on=n[15];return c[0]=i,c[1]=h,c[2]=q,c[3]=K,c[4]=s,c[5]=x,c[6]=F,c[7]=X,c[8]=a,c[9]=B,c[10]=R,c[11]=W,c[12]=d,c[13]=P,c[14]=N,c[15]=on,c}function j(n,f){const c=f??new e(16),i=n[0],s=n[1],a=n[2],d=n[3],h=n[4],x=n[5],B=n[6],P=n[7],q=n[8],F=n[9],R=n[10],N=n[11],K=n[12],X=n[13],W=n[14],on=n[15],rn=R*on,dn=W*N,pn=B*on,Mn=W*P,Dn=B*N,vn=R*P,xn=a*on,En=W*d,_n=a*N,An=R*d,Pn=a*P,Sn=B*d,Tn=q*X,Un=K*F,qn=h*X,Vn=K*x,Gn=h*F,Kn=q*x,kn=i*X,bn=K*s,Cn=i*F,nt=q*s,tt=i*x,et=h*s,Mt=rn*x+Mn*F+Dn*X-(dn*x+pn*F+vn*X),yt=dn*s+xn*F+An*X-(rn*s+En*F+_n*X),gt=pn*s+En*x+Pn*X-(Mn*s+xn*x+Sn*X),Dt=vn*s+_n*x+Sn*F-(Dn*s+An*x+Pn*F),zn=1/(i*Mt+h*yt+q*gt+K*Dt);return c[0]=zn*Mt,c[1]=zn*yt,c[2]=zn*gt,c[3]=zn*Dt,c[4]=zn*(dn*h+pn*q+vn*K-(rn*h+Mn*q+Dn*K)),c[5]=zn*(rn*i+En*q+_n*K-(dn*i+xn*q+An*K)),c[6]=zn*(Mn*i+xn*h+Sn*K-(pn*i+En*h+Pn*K)),c[7]=zn*(Dn*i+An*h+Pn*q-(vn*i+_n*h+Sn*q)),c[8]=zn*(Tn*P+Vn*N+Gn*on-(Un*P+qn*N+Kn*on)),c[9]=zn*(Un*d+kn*N+nt*on-(Tn*d+bn*N+Cn*on)),c[10]=zn*(qn*d+bn*P+tt*on-(Vn*d+kn*P+et*on)),c[11]=zn*(Kn*d+Cn*P+et*N-(Gn*d+nt*P+tt*N)),c[12]=zn*(qn*R+Kn*W+Un*B-(Gn*W+Tn*B+Vn*R)),c[13]=zn*(Cn*W+Tn*a+bn*R-(kn*R+nt*W+Un*a)),c[14]=zn*(kn*B+et*W+Vn*a-(tt*W+qn*a+bn*B)),c[15]=zn*(tt*R+Gn*a+nt*B-(Cn*B+et*R+Kn*a)),c}function m(n){const f=n[0],c=n[1],i=n[2],s=n[3],a=n[4],d=n[5],h=n[6],x=n[7],B=n[8],P=n[9],q=n[10],F=n[11],R=n[12],N=n[13],K=n[14],X=n[15],W=q*X,on=K*F,rn=h*X,dn=K*x,pn=h*F,Mn=q*x,Dn=i*X,vn=K*s,xn=i*F,En=q*s,_n=i*x,An=h*s,Pn=W*d+dn*P+pn*N-(on*d+rn*P+Mn*N),Sn=on*c+Dn*P+En*N-(W*c+vn*P+xn*N),Tn=rn*c+vn*d+_n*N-(dn*c+Dn*d+An*N),Un=Mn*c+xn*d+An*P-(pn*c+En*d+_n*P);return f*Pn+a*Sn+B*Tn+R*Un}const J=j;function $(n,f,c){const i=c??new e(16),s=n[0],a=n[1],d=n[2],h=n[3],x=n[4],B=n[5],P=n[6],q=n[7],F=n[8],R=n[9],N=n[10],K=n[11],X=n[12],W=n[13],on=n[14],rn=n[15],dn=f[0],pn=f[1],Mn=f[2],Dn=f[3],vn=f[4],xn=f[5],En=f[6],_n=f[7],An=f[8],Pn=f[9],Sn=f[10],Tn=f[11],Un=f[12],qn=f[13],Vn=f[14],Gn=f[15];return i[0]=s*dn+x*pn+F*Mn+X*Dn,i[1]=a*dn+B*pn+R*Mn+W*Dn,i[2]=d*dn+P*pn+N*Mn+on*Dn,i[3]=h*dn+q*pn+K*Mn+rn*Dn,i[4]=s*vn+x*xn+F*En+X*_n,i[5]=a*vn+B*xn+R*En+W*_n,i[6]=d*vn+P*xn+N*En+on*_n,i[7]=h*vn+q*xn+K*En+rn*_n,i[8]=s*An+x*Pn+F*Sn+X*Tn,i[9]=a*An+B*Pn+R*Sn+W*Tn,i[10]=d*An+P*Pn+N*Sn+on*Tn,i[11]=h*An+q*Pn+K*Sn+rn*Tn,i[12]=s*Un+x*qn+F*Vn+X*Gn,i[13]=a*Un+B*qn+R*Vn+W*Gn,i[14]=d*Un+P*qn+N*Vn+on*Gn,i[15]=h*Un+q*qn+K*Vn+rn*Gn,i}const Q=$;function Y(n,f,c){const i=c??O();return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11]),i[12]=f[0],i[13]=f[1],i[14]=f[2],i[15]=1,i}function Z(n,f){const c=f??r.create();return c[0]=n[12],c[1]=n[13],c[2]=n[14],c}function fn(n,f,c){const i=c??r.create(),s=f*4;return i[0]=n[s+0],i[1]=n[s+1],i[2]=n[s+2],i}function cn(n,f,c,i){const s=i===n?i:V(n,i),a=c*4;return s[a+0]=f[0],s[a+1]=f[1],s[a+2]=f[2],s}function en(n,f){const c=f??r.create(),i=n[0],s=n[1],a=n[2],d=n[4],h=n[5],x=n[6],B=n[8],P=n[9],q=n[10];return c[0]=Math.sqrt(i*i+s*s+a*a),c[1]=Math.sqrt(d*d+h*h+x*x),c[2]=Math.sqrt(B*B+P*P+q*q),c}function b(n,f,c,i,s){const a=s??new e(16),d=Math.tan(Math.PI*.5-.5*n);if(a[0]=d/f,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,Number.isFinite(i)){const h=1/(c-i);a[10]=i*h,a[14]=i*c*h}else a[10]=-1,a[14]=-c;return a}function an(n,f,c,i=1/0,s){const a=s??new e(16),d=1/Math.tan(n*.5);if(a[0]=d/f,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,i===1/0)a[10]=0,a[14]=c;else{const h=1/(i-c);a[10]=c*h,a[14]=i*c*h}return a}function ln(n,f,c,i,s,a,d){const h=d??new e(16);return h[0]=2/(f-n),h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2/(i-c),h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1/(s-a),h[11]=0,h[12]=(f+n)/(n-f),h[13]=(i+c)/(c-i),h[14]=s/(s-a),h[15]=1,h}function hn(n,f,c,i,s,a,d){const h=d??new e(16),x=f-n,B=i-c,P=s-a;return h[0]=2*s/x,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*s/B,h[6]=0,h[7]=0,h[8]=(n+f)/x,h[9]=(i+c)/B,h[10]=a/P,h[11]=-1,h[12]=0,h[13]=0,h[14]=s*a/P,h[15]=0,h}function nn(n,f,c,i,s,a=1/0,d){const h=d??new e(16),x=f-n,B=i-c;if(h[0]=2*s/x,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*s/B,h[6]=0,h[7]=0,h[8]=(n+f)/x,h[9]=(i+c)/B,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,a===1/0)h[10]=0,h[14]=s;else{const P=1/(a-s);h[10]=s*P,h[14]=a*s*P}return h}const tn=r.create(),sn=r.create(),C=r.create();function yn(n,f,c,i){const s=i??new e(16);return r.normalize(r.subtract(f,n,C),C),r.normalize(r.cross(c,C,tn),tn),r.normalize(r.cross(C,tn,sn),sn),s[0]=tn[0],s[1]=tn[1],s[2]=tn[2],s[3]=0,s[4]=sn[0],s[5]=sn[1],s[6]=sn[2],s[7]=0,s[8]=C[0],s[9]=C[1],s[10]=C[2],s[11]=0,s[12]=n[0],s[13]=n[1],s[14]=n[2],s[15]=1,s}function wn(n,f,c,i){const s=i??new e(16);return r.normalize(r.subtract(n,f,C),C),r.normalize(r.cross(c,C,tn),tn),r.normalize(r.cross(C,tn,sn),sn),s[0]=tn[0],s[1]=tn[1],s[2]=tn[2],s[3]=0,s[4]=sn[0],s[5]=sn[1],s[6]=sn[2],s[7]=0,s[8]=C[0],s[9]=C[1],s[10]=C[2],s[11]=0,s[12]=n[0],s[13]=n[1],s[14]=n[2],s[15]=1,s}function un(n,f,c,i){const s=i??new e(16);return r.normalize(r.subtract(n,f,C),C),r.normalize(r.cross(c,C,tn),tn),r.normalize(r.cross(C,tn,sn),sn),s[0]=tn[0],s[1]=sn[0],s[2]=C[0],s[3]=0,s[4]=tn[1],s[5]=sn[1],s[6]=C[1],s[7]=0,s[8]=tn[2],s[9]=sn[2],s[10]=C[2],s[11]=0,s[12]=-(tn[0]*n[0]+tn[1]*n[1]+tn[2]*n[2]),s[13]=-(sn[0]*n[0]+sn[1]*n[1]+sn[2]*n[2]),s[14]=-(C[0]*n[0]+C[1]*n[1]+C[2]*n[2]),s[15]=1,s}function Bn(n,f){const c=f??new e(16);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=n[0],c[13]=n[1],c[14]=n[2],c[15]=1,c}function gn(n,f,c){const i=c??new e(16),s=f[0],a=f[1],d=f[2],h=n[0],x=n[1],B=n[2],P=n[3],q=n[4],F=n[5],R=n[6],N=n[7],K=n[8],X=n[9],W=n[10],on=n[11],rn=n[12],dn=n[13],pn=n[14],Mn=n[15];return n!==i&&(i[0]=h,i[1]=x,i[2]=B,i[3]=P,i[4]=q,i[5]=F,i[6]=R,i[7]=N,i[8]=K,i[9]=X,i[10]=W,i[11]=on),i[12]=h*s+q*a+K*d+rn,i[13]=x*s+F*a+X*d+dn,i[14]=B*s+R*a+W*d+pn,i[15]=P*s+N*a+on*d+Mn,i}function On(n,f){const c=f??new e(16),i=Math.cos(n),s=Math.sin(n);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i,c[6]=s,c[7]=0,c[8]=0,c[9]=-s,c[10]=i,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Fn(n,f,c){const i=c??new e(16),s=n[4],a=n[5],d=n[6],h=n[7],x=n[8],B=n[9],P=n[10],q=n[11],F=Math.cos(f),R=Math.sin(f);return i[4]=F*s+R*x,i[5]=F*a+R*B,i[6]=F*d+R*P,i[7]=F*h+R*q,i[8]=F*x-R*s,i[9]=F*B-R*a,i[10]=F*P-R*d,i[11]=F*q-R*h,n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i}function Yn(n,f){const c=f??new e(16),i=Math.cos(n),s=Math.sin(n);return c[0]=i,c[1]=0,c[2]=-s,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=s,c[9]=0,c[10]=i,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function In(n,f,c){const i=c??new e(16),s=n[0],a=n[1],d=n[2],h=n[3],x=n[8],B=n[9],P=n[10],q=n[11],F=Math.cos(f),R=Math.sin(f);return i[0]=F*s-R*x,i[1]=F*a-R*B,i[2]=F*d-R*P,i[3]=F*h-R*q,i[8]=F*x+R*s,i[9]=F*B+R*a,i[10]=F*P+R*d,i[11]=F*q+R*h,n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i}function v(n,f){const c=f??new e(16),i=Math.cos(n),s=Math.sin(n);return c[0]=i,c[1]=s,c[2]=0,c[3]=0,c[4]=-s,c[5]=i,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function T(n,f,c){const i=c??new e(16),s=n[0],a=n[1],d=n[2],h=n[3],x=n[4],B=n[5],P=n[6],q=n[7],F=Math.cos(f),R=Math.sin(f);return i[0]=F*s+R*x,i[1]=F*a+R*B,i[2]=F*d+R*P,i[3]=F*h+R*q,i[4]=F*x-R*s,i[5]=F*B-R*a,i[6]=F*P-R*d,i[7]=F*q-R*h,n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i}function w(n,f,c){const i=c??new e(16);let s=n[0],a=n[1],d=n[2];const h=Math.sqrt(s*s+a*a+d*d);s/=h,a/=h,d/=h;const x=s*s,B=a*a,P=d*d,q=Math.cos(f),F=Math.sin(f),R=1-q;return i[0]=x+(1-x)*q,i[1]=s*a*R+d*F,i[2]=s*d*R-a*F,i[3]=0,i[4]=s*a*R-d*F,i[5]=B+(1-B)*q,i[6]=a*d*R+s*F,i[7]=0,i[8]=s*d*R+a*F,i[9]=a*d*R-s*F,i[10]=P+(1-P)*q,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}const t=w;function u(n,f,c,i){const s=i??new e(16);let a=f[0],d=f[1],h=f[2];const x=Math.sqrt(a*a+d*d+h*h);a/=x,d/=x,h/=x;const B=a*a,P=d*d,q=h*h,F=Math.cos(c),R=Math.sin(c),N=1-F,K=B+(1-B)*F,X=a*d*N+h*R,W=a*h*N-d*R,on=a*d*N-h*R,rn=P+(1-P)*F,dn=d*h*N+a*R,pn=a*h*N+d*R,Mn=d*h*N-a*R,Dn=q+(1-q)*F,vn=n[0],xn=n[1],En=n[2],_n=n[3],An=n[4],Pn=n[5],Sn=n[6],Tn=n[7],Un=n[8],qn=n[9],Vn=n[10],Gn=n[11];return s[0]=K*vn+X*An+W*Un,s[1]=K*xn+X*Pn+W*qn,s[2]=K*En+X*Sn+W*Vn,s[3]=K*_n+X*Tn+W*Gn,s[4]=on*vn+rn*An+dn*Un,s[5]=on*xn+rn*Pn+dn*qn,s[6]=on*En+rn*Sn+dn*Vn,s[7]=on*_n+rn*Tn+dn*Gn,s[8]=pn*vn+Mn*An+Dn*Un,s[9]=pn*xn+Mn*Pn+Dn*qn,s[10]=pn*En+Mn*Sn+Dn*Vn,s[11]=pn*_n+Mn*Tn+Dn*Gn,n!==s&&(s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s}const o=u;function l(n,f){const c=f??new e(16);return c[0]=n[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=n[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=n[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function p(n,f,c){const i=c??new e(16),s=f[0],a=f[1],d=f[2];return i[0]=s*n[0],i[1]=s*n[1],i[2]=s*n[2],i[3]=s*n[3],i[4]=a*n[4],i[5]=a*n[5],i[6]=a*n[6],i[7]=a*n[7],i[8]=d*n[8],i[9]=d*n[9],i[10]=d*n[10],i[11]=d*n[11],n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i}function y(n,f){const c=f??new e(16);return c[0]=n,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=n,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=n,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function g(n,f,c){const i=c??new e(16);return i[0]=f*n[0],i[1]=f*n[1],i[2]=f*n[2],i[3]=f*n[3],i[4]=f*n[4],i[5]=f*n[5],i[6]=f*n[6],i[7]=f*n[7],i[8]=f*n[8],i[9]=f*n[9],i[10]=f*n[10],i[11]=f*n[11],n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i}return{add:z,aim:yn,axisRotate:u,axisRotation:w,cameraAim:wn,clone:G,copy:V,create:M,determinant:m,equals:L,equalsApproximately:I,fromMat3:E,fromQuat:S,frustum:hn,frustumReverseZ:nn,getAxis:fn,getScaling:en,getTranslation:Z,identity:O,inverse:j,invert:J,lookAt:un,mul:Q,mulScalar:A,multiply:$,multiplyScalar:U,negate:_,ortho:ln,perspective:b,perspectiveReverseZ:an,rotate:o,rotateX:Fn,rotateY:In,rotateZ:T,rotation:t,rotationX:On,rotationY:Yn,rotationZ:v,scale:p,scaling:l,set:D,setAxis:cn,setTranslation:Y,translate:gn,translation:Bn,transpose:H,uniformScale:g,uniformScaling:y}}const Ut=new Map;function ie(e){let r=Ut.get(e);return r||(r=oe(e),Ut.set(e,r)),r}function ae(e){const r=ut(e);function M(v,T,w,t){const u=new e(4);return v!==void 0&&(u[0]=v,T!==void 0&&(u[1]=T,w!==void 0&&(u[2]=w,t!==void 0&&(u[3]=t)))),u}const D=M;function E(v,T,w,t,u){const o=u??new e(4);return o[0]=v,o[1]=T,o[2]=w,o[3]=t,o}function S(v,T,w){const t=w??new e(4),u=T*.5,o=Math.sin(u);return t[0]=o*v[0],t[1]=o*v[1],t[2]=o*v[2],t[3]=Math.cos(u),t}function _(v,T){const w=T??r.create(3),t=Math.acos(v[3])*2,u=Math.sin(t*.5);return u>k?(w[0]=v[0]/u,w[1]=v[1]/u,w[2]=v[2]/u):(w[0]=1,w[1]=0,w[2]=0),{angle:t,axis:w}}function z(v,T){const w=b(v,T);return Math.acos(2*w*w-1)}function U(v,T,w){const t=w??new e(4),u=v[0],o=v[1],l=v[2],p=v[3],y=T[0],g=T[1],n=T[2],f=T[3];return t[0]=u*f+p*y+o*n-l*g,t[1]=o*f+p*g+l*y-u*n,t[2]=l*f+p*n+u*g-o*y,t[3]=p*f-u*y-o*g-l*n,t}const A=U;function V(v,T,w){const t=w??new e(4),u=T*.5,o=v[0],l=v[1],p=v[2],y=v[3],g=Math.sin(u),n=Math.cos(u);return t[0]=o*n+y*g,t[1]=l*n+p*g,t[2]=p*n-l*g,t[3]=y*n-o*g,t}function G(v,T,w){const t=w??new e(4),u=T*.5,o=v[0],l=v[1],p=v[2],y=v[3],g=Math.sin(u),n=Math.cos(u);return t[0]=o*n-p*g,t[1]=l*n+y*g,t[2]=p*n+o*g,t[3]=y*n-l*g,t}function I(v,T,w){const t=w??new e(4),u=T*.5,o=v[0],l=v[1],p=v[2],y=v[3],g=Math.sin(u),n=Math.cos(u);return t[0]=o*n+l*g,t[1]=l*n-o*g,t[2]=p*n+y*g,t[3]=y*n-p*g,t}function L(v,T,w,t){const u=t??new e(4),o=v[0],l=v[1],p=v[2],y=v[3];let g=T[0],n=T[1],f=T[2],c=T[3],i=o*g+l*n+p*f+y*c;i<0&&(i=-i,g=-g,n=-n,f=-f,c=-c);let s,a;if(1-i>k){const d=Math.acos(i),h=Math.sin(d);s=Math.sin((1-w)*d)/h,a=Math.sin(w*d)/h}else s=1-w,a=w;return u[0]=s*o+a*g,u[1]=s*l+a*n,u[2]=s*p+a*f,u[3]=s*y+a*c,u}function O(v,T){const w=T??new e(4),t=v[0],u=v[1],o=v[2],l=v[3],p=t*t+u*u+o*o+l*l,y=p?1/p:0;return w[0]=-t*y,w[1]=-u*y,w[2]=-o*y,w[3]=l*y,w}function H(v,T){const w=T??new e(4);return w[0]=-v[0],w[1]=-v[1],w[2]=-v[2],w[3]=v[3],w}function j(v,T){const w=T??new e(4),t=v[0]+v[5]+v[10];if(t>0){const u=Math.sqrt(t+1);w[3]=.5*u;const o=.5/u;w[0]=(v[6]-v[9])*o,w[1]=(v[8]-v[2])*o,w[2]=(v[1]-v[4])*o}else{let u=0;v[5]>v[0]&&(u=1),v[10]>v[u*4+u]&&(u=2);const o=(u+1)%3,l=(u+2)%3,p=Math.sqrt(v[u*4+u]-v[o*4+o]-v[l*4+l]+1);w[u]=.5*p;const y=.5/p;w[3]=(v[o*4+l]-v[l*4+o])*y,w[o]=(v[o*4+u]+v[u*4+o])*y,w[l]=(v[l*4+u]+v[u*4+l])*y}return w}function m(v,T,w,t,u){const o=u??new e(4),l=v*.5,p=T*.5,y=w*.5,g=Math.sin(l),n=Math.cos(l),f=Math.sin(p),c=Math.cos(p),i=Math.sin(y),s=Math.cos(y);switch(t){case"xyz":o[0]=g*c*s+n*f*i,o[1]=n*f*s-g*c*i,o[2]=n*c*i+g*f*s,o[3]=n*c*s-g*f*i;break;case"xzy":o[0]=g*c*s-n*f*i,o[1]=n*f*s-g*c*i,o[2]=n*c*i+g*f*s,o[3]=n*c*s+g*f*i;break;case"yxz":o[0]=g*c*s+n*f*i,o[1]=n*f*s-g*c*i,o[2]=n*c*i-g*f*s,o[3]=n*c*s+g*f*i;break;case"yzx":o[0]=g*c*s+n*f*i,o[1]=n*f*s+g*c*i,o[2]=n*c*i-g*f*s,o[3]=n*c*s-g*f*i;break;case"zxy":o[0]=g*c*s-n*f*i,o[1]=n*f*s+g*c*i,o[2]=n*c*i+g*f*s,o[3]=n*c*s-g*f*i;break;case"zyx":o[0]=g*c*s-n*f*i,o[1]=n*f*s+g*c*i,o[2]=n*c*i-g*f*s,o[3]=n*c*s+g*f*i;break;default:throw new Error(`Unknown rotation order: ${t}`)}return o}function J(v,T){const w=T??new e(4);return w[0]=v[0],w[1]=v[1],w[2]=v[2],w[3]=v[3],w}const $=J;function Q(v,T,w){const t=w??new e(4);return t[0]=v[0]+T[0],t[1]=v[1]+T[1],t[2]=v[2]+T[2],t[3]=v[3]+T[3],t}function Y(v,T,w){const t=w??new e(4);return t[0]=v[0]-T[0],t[1]=v[1]-T[1],t[2]=v[2]-T[2],t[3]=v[3]-T[3],t}const Z=Y;function fn(v,T,w){const t=w??new e(4);return t[0]=v[0]*T,t[1]=v[1]*T,t[2]=v[2]*T,t[3]=v[3]*T,t}const cn=fn;function en(v,T,w){const t=w??new e(4);return t[0]=v[0]/T,t[1]=v[1]/T,t[2]=v[2]/T,t[3]=v[3]/T,t}function b(v,T){return v[0]*T[0]+v[1]*T[1]+v[2]*T[2]+v[3]*T[3]}function an(v,T,w,t){const u=t??new e(4);return u[0]=v[0]+w*(T[0]-v[0]),u[1]=v[1]+w*(T[1]-v[1]),u[2]=v[2]+w*(T[2]-v[2]),u[3]=v[3]+w*(T[3]-v[3]),u}function ln(v){const T=v[0],w=v[1],t=v[2],u=v[3];return Math.sqrt(T*T+w*w+t*t+u*u)}const hn=ln;function nn(v){const T=v[0],w=v[1],t=v[2],u=v[3];return T*T+w*w+t*t+u*u}const tn=nn;function sn(v,T){const w=T??new e(4),t=v[0],u=v[1],o=v[2],l=v[3],p=Math.sqrt(t*t+u*u+o*o+l*l);return p>1e-5?(w[0]=t/p,w[1]=u/p,w[2]=o/p,w[3]=l/p):(w[0]=0,w[1]=0,w[2]=0,w[3]=1),w}function C(v,T){return Math.abs(v[0]-T[0])<k&&Math.abs(v[1]-T[1])<k&&Math.abs(v[2]-T[2])<k&&Math.abs(v[3]-T[3])<k}function yn(v,T){return v[0]===T[0]&&v[1]===T[1]&&v[2]===T[2]&&v[3]===T[3]}function wn(v){const T=v??new e(4);return T[0]=0,T[1]=0,T[2]=0,T[3]=1,T}const un=r.create(),Bn=r.create(),gn=r.create();function On(v,T,w){const t=w??new e(4),u=r.dot(v,T);return u<-.999999?(r.cross(Bn,v,un),r.len(un)<1e-6&&r.cross(gn,v,un),r.normalize(un,un),S(un,Math.PI,t),t):u>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(r.cross(v,T,un),t[0]=un[0],t[1]=un[1],t[2]=un[2],t[3]=1+u,sn(t,t))}const Fn=new e(4),Yn=new e(4);function In(v,T,w,t,u,o){const l=o??new e(4);return L(v,t,u,Fn),L(T,w,u,Yn),L(Fn,Yn,2*u*(1-u),l),l}return{create:M,fromValues:D,set:E,fromAxisAngle:S,toAxisAngle:_,angle:z,multiply:U,mul:A,rotateX:V,rotateY:G,rotateZ:I,slerp:L,inverse:O,conjugate:H,fromMat:j,fromEuler:m,copy:J,clone:$,add:Q,subtract:Y,sub:Z,mulScalar:fn,scale:cn,divScalar:en,dot:b,lerp:an,length:ln,len:hn,lengthSq:nn,lenSq:tn,normalize:sn,equalsApproximately:C,equals:yn,identity:wn,rotationTo:On,sqlerp:In}}const Ft=new Map;function ue(e){let r=Ft.get(e);return r||(r=ae(e),Ft.set(e,r)),r}function fe(e){function r(w,t,u,o){const l=new e(4);return w!==void 0&&(l[0]=w,t!==void 0&&(l[1]=t,u!==void 0&&(l[2]=u,o!==void 0&&(l[3]=o)))),l}const M=r;function D(w,t,u,o,l){const p=l??new e(4);return p[0]=w,p[1]=t,p[2]=u,p[3]=o,p}function E(w,t){const u=t??new e(4);return u[0]=Math.ceil(w[0]),u[1]=Math.ceil(w[1]),u[2]=Math.ceil(w[2]),u[3]=Math.ceil(w[3]),u}function S(w,t){const u=t??new e(4);return u[0]=Math.floor(w[0]),u[1]=Math.floor(w[1]),u[2]=Math.floor(w[2]),u[3]=Math.floor(w[3]),u}function _(w,t){const u=t??new e(4);return u[0]=Math.round(w[0]),u[1]=Math.round(w[1]),u[2]=Math.round(w[2]),u[3]=Math.round(w[3]),u}function z(w,t=0,u=1,o){const l=o??new e(4);return l[0]=Math.min(u,Math.max(t,w[0])),l[1]=Math.min(u,Math.max(t,w[1])),l[2]=Math.min(u,Math.max(t,w[2])),l[3]=Math.min(u,Math.max(t,w[3])),l}function U(w,t,u){const o=u??new e(4);return o[0]=w[0]+t[0],o[1]=w[1]+t[1],o[2]=w[2]+t[2],o[3]=w[3]+t[3],o}function A(w,t,u,o){const l=o??new e(4);return l[0]=w[0]+t[0]*u,l[1]=w[1]+t[1]*u,l[2]=w[2]+t[2]*u,l[3]=w[3]+t[3]*u,l}function V(w,t,u){const o=u??new e(4);return o[0]=w[0]-t[0],o[1]=w[1]-t[1],o[2]=w[2]-t[2],o[3]=w[3]-t[3],o}const G=V;function I(w,t){return Math.abs(w[0]-t[0])<k&&Math.abs(w[1]-t[1])<k&&Math.abs(w[2]-t[2])<k&&Math.abs(w[3]-t[3])<k}function L(w,t){return w[0]===t[0]&&w[1]===t[1]&&w[2]===t[2]&&w[3]===t[3]}function O(w,t,u,o){const l=o??new e(4);return l[0]=w[0]+u*(t[0]-w[0]),l[1]=w[1]+u*(t[1]-w[1]),l[2]=w[2]+u*(t[2]-w[2]),l[3]=w[3]+u*(t[3]-w[3]),l}function H(w,t,u,o){const l=o??new e(4);return l[0]=w[0]+u[0]*(t[0]-w[0]),l[1]=w[1]+u[1]*(t[1]-w[1]),l[2]=w[2]+u[2]*(t[2]-w[2]),l[3]=w[3]+u[3]*(t[3]-w[3]),l}function j(w,t,u){const o=u??new e(4);return o[0]=Math.max(w[0],t[0]),o[1]=Math.max(w[1],t[1]),o[2]=Math.max(w[2],t[2]),o[3]=Math.max(w[3],t[3]),o}function m(w,t,u){const o=u??new e(4);return o[0]=Math.min(w[0],t[0]),o[1]=Math.min(w[1],t[1]),o[2]=Math.min(w[2],t[2]),o[3]=Math.min(w[3],t[3]),o}function J(w,t,u){const o=u??new e(4);return o[0]=w[0]*t,o[1]=w[1]*t,o[2]=w[2]*t,o[3]=w[3]*t,o}const $=J;function Q(w,t,u){const o=u??new e(4);return o[0]=w[0]/t,o[1]=w[1]/t,o[2]=w[2]/t,o[3]=w[3]/t,o}function Y(w,t){const u=t??new e(4);return u[0]=1/w[0],u[1]=1/w[1],u[2]=1/w[2],u[3]=1/w[3],u}const Z=Y;function fn(w,t){return w[0]*t[0]+w[1]*t[1]+w[2]*t[2]+w[3]*t[3]}function cn(w){const t=w[0],u=w[1],o=w[2],l=w[3];return Math.sqrt(t*t+u*u+o*o+l*l)}const en=cn;function b(w){const t=w[0],u=w[1],o=w[2],l=w[3];return t*t+u*u+o*o+l*l}const an=b;function ln(w,t){const u=w[0]-t[0],o=w[1]-t[1],l=w[2]-t[2],p=w[3]-t[3];return Math.sqrt(u*u+o*o+l*l+p*p)}const hn=ln;function nn(w,t){const u=w[0]-t[0],o=w[1]-t[1],l=w[2]-t[2],p=w[3]-t[3];return u*u+o*o+l*l+p*p}const tn=nn;function sn(w,t){const u=t??new e(4),o=w[0],l=w[1],p=w[2],y=w[3],g=Math.sqrt(o*o+l*l+p*p+y*y);return g>1e-5?(u[0]=o/g,u[1]=l/g,u[2]=p/g,u[3]=y/g):(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function C(w,t){const u=t??new e(4);return u[0]=-w[0],u[1]=-w[1],u[2]=-w[2],u[3]=-w[3],u}function yn(w,t){const u=t??new e(4);return u[0]=w[0],u[1]=w[1],u[2]=w[2],u[3]=w[3],u}const wn=yn;function un(w,t,u){const o=u??new e(4);return o[0]=w[0]*t[0],o[1]=w[1]*t[1],o[2]=w[2]*t[2],o[3]=w[3]*t[3],o}const Bn=un;function gn(w,t,u){const o=u??new e(4);return o[0]=w[0]/t[0],o[1]=w[1]/t[1],o[2]=w[2]/t[2],o[3]=w[3]/t[3],o}const On=gn;function Fn(w){const t=w??new e(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Yn(w,t,u){const o=u??new e(4),l=w[0],p=w[1],y=w[2],g=w[3];return o[0]=t[0]*l+t[4]*p+t[8]*y+t[12]*g,o[1]=t[1]*l+t[5]*p+t[9]*y+t[13]*g,o[2]=t[2]*l+t[6]*p+t[10]*y+t[14]*g,o[3]=t[3]*l+t[7]*p+t[11]*y+t[15]*g,o}function In(w,t,u){const o=u??new e(4);return sn(w,o),J(o,t,o)}function v(w,t,u){const o=u??new e(4);return cn(w)>t?In(w,t,o):yn(w,o)}function T(w,t,u){const o=u??new e(4);return O(w,t,.5,o)}return{create:r,fromValues:M,set:D,ceil:E,floor:S,round:_,clamp:z,add:U,addScaled:A,subtract:V,sub:G,equalsApproximately:I,equals:L,lerp:O,lerpV:H,max:j,min:m,mulScalar:J,scale:$,divScalar:Q,inverse:Y,invert:Z,dot:fn,length:cn,len:en,lengthSq:b,lenSq:an,distance:ln,dist:hn,distanceSq:nn,distSq:tn,normalize:sn,negate:C,copy:yn,clone:wn,multiply:un,mul:Bn,divide:gn,div:On,zero:Fn,transformMat4:Yn,setLength:In,truncate:v,midpoint:T}}const Rt=new Map;function le(e){let r=Rt.get(e);return r||(r=fe(e),Rt.set(e,r)),r}function pt(e,r,M,D,E,S){return{mat3:re(e),mat4:ie(r),quat:ue(M),vec2:Yt(D),vec3:ut(E),vec4:le(S)}}const{mat3:Ln,mat4:wt,quat:qt,vec2:jn,vec3:it,vec4:Nn}=pt(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);pt(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);pt(te,Array,Array,Array,Array,Array);class he{_position;_rotation;_scale;_color;_opacity;_covariance3d;_basis2d;constructor(r,M,D,E,S){this._position=r,this._rotation=M,this._scale=D,this._color=E,this._opacity=S;const _=qt.create(M[1],M[2],M[3],M[0]);qt.normalize(_,_);const z=wt.fromQuat(_),U=Ln.fromMat4(z),A=wt.scaling(D),V=Ln.fromMat4(A),G=Ln.multiply(U,V),I=Ln.transpose(G),L=Ln.multiply(G,I);this._covariance3d=L,this._basis2d=Nn.create(1,-1,1,1)}updateBasis(r,M,D){const E={x:D.clientWidth,y:D.clientHeight},S={x:r[0]*E.x*.5,y:r[5]*E.y*.5},_=Nn.transformMat4(Nn.fromValues(this._position[0],this._position[1],this._position[2],1),M),z=1/(_[2]*_[2]),U=Ln.create(-S.x/_[2],0,S.x*_[0]*z,0,-S.y/_[2],S.y*_[1]*z,0,0,0),A=Ln.transpose(Ln.fromMat4(M)),V=Ln.multiply(A,U),G=Ln.multiply(Ln.transpose(V),Ln.multiply(this._covariance3d,V)),I=G[0],L=G[1],O=G[5],H=I*O-L*L,m=(I+O)/2,J=Math.sqrt(m*m-H),$=m+J,Q=Math.max(m-J,0),Y=1024,Z=jn.normalize(jn.fromValues(L,$-I)),fn=jn.fromValues(Z[1],-Z[0]),cn=jn.scale(Z,Math.min(Math.sqrt($)*4,Y)),en=jn.scale(fn,Math.min(Math.sqrt(Q)*4,Y));this._basis2d=Nn.fromValues(cn[0],cn[1],en[0],en[1])}get position(){return this._position}get rotation(){return this._rotation}get scale(){return this._scale}get color(){return this._color}get opacity(){return this._opacity}get basis(){return this._basis2d}}class we{header=[];format="";numVertices=0;properties=[];headerLength=0;rawVertices=[];splattifiedVertices=[];async loadPlyFile(r){const M=await r.arrayBuffer(),D=new TextDecoder;let E="";const S=new Uint8Array(M,0,Math.min(2048,M.byteLength));E=D.decode(S);const _=E.indexOf(`end_header
`);if(_===-1)throw new Error("Invalid PLY file: Cannot find end of header");this.headerLength=_+11;const z=E.slice(0,_).split(`
`).map(A=>A.trim());let U=0;if(z[U]!=="ply")throw new Error('Invalid PLY file: Missing "ply" header');for(U++;U<z.length;){const A=z[U];if(this.header.push(A),A.startsWith("format"))this.format=A.split(" ")[1];else if(A.startsWith("element vertex"))this.numVertices=parseInt(A.split(" ")[2]);else if(A.startsWith("comment"))console.log("CommentLine",A);else if(A.startsWith("property")){const V=A.split(" ");this.properties.push({name:V[2],type:V[1]})}U++}if(this.format==="binary_little_endian")this.rawVertices=this.parseBinary(M);else if(this.format==="ascii")this.rawVertices=this.parseASCII(M,_);else throw new Error(`Unsupported PLY format: ${this.format}`);this.splattifiedVertices=this.splatifyVertices(this.rawVertices)}parseBinary(r){const M=new DataView(r),D=[];let E=this.headerLength;for(let S=0;S<this.numVertices;S++){const _={};for(const z of this.properties){const U=this.readBinaryValue(M,E,z.type);_[z.name]=U,E+=this.getTypeSize(z.type)}D.push(_)}return D}parseASCII(r,M){const S=new TextDecoder().decode(r.slice(M)).trim().split(`
`),_=[];for(let z=0;z<this.numVertices;z++){const U={},A=S[z].split(/\s+/);for(let V=0;V<this.properties.length;V++)U[this.properties[V].name]=parseFloat(A[V]);_.push(U)}return _}splatifyVertices(r){const M=.28209479177387814,D=[];for(const E of r){const S=new Float32Array([E.x,E.y,E.z]),_=Nn.create(E.rot_0,E.rot_1,E.rot_2,E.rot_3),z=Nn.create(Math.exp(E.scale_0),Math.exp(E.scale_1),Math.exp(E.scale_2)),U=it.create(.5+M*E.f_dc_0,.5+M*E.f_dc_1,.5+M*E.f_dc_2),A=1/(1+Math.exp(-E.opacity)),V=new he(S,_,z,U,A);D.push(V)}return D}readBinaryValue(r,M,D){switch(D){case"float":case"float32":return r.getFloat32(M,!0);case"float64":case"double":return r.getFloat64(M,!0);case"int8":return r.getInt8(M);case"uint8":return r.getUint8(M);case"int16":return r.getInt16(M,!0);case"uint16":return r.getUint16(M,!0);case"int32":return r.getInt32(M,!0);case"uint32":return r.getUint32(M,!0);default:throw new Error(`Unsupported binary type: ${D}`)}}getTypeSize(r){switch(r){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float":case"float32":return 4;case"float64":case"double":return 8;default:throw new Error(`Unknown type size for: ${r}`)}}getSplattifiedVertices(){return this.splattifiedVertices}}const de=`@group(0) @binding(0)
var<uniform> projection: mat4x4<f32>;

@group(0) @binding(1)
var<uniform> modelView: mat4x4<f32>;

@group(0) @binding(2)
var<uniform> screen_size: vec2<f32>;

@group(0) @binding(3)
var<uniform> splat_radius: f32;

@group(1) @binding(0)  
var<storage, read> inCentroids:array<vec3<f32>>;

@group(1) @binding(1)  
var<storage, read> inBasis :array<vec4<f32>>;

@group(1) @binding(2) 
var<storage, read> inColors :array<vec4<f32>>;


struct VertexOutput {
    @builtin(position) clip_position: vec4<f32>,
    @location(0) coord: vec2<f32>,
    @location(1) color: vec4<f32>,
};

@vertex
fn vs_main(@location(0) inPos: vec2<f32>, @location(1) inId: u32) -> VertexOutput {
    var out: VertexOutput;
    
    var clipCenter: vec4<f32> = projection * modelView * vec4<f32>(inCentroids[inId], 1.0);
    var ndcCenter: vec3<f32> = clipCenter.xyz / clipCenter.w;
    var basisViewport: vec2<f32> = vec2<f32>(2.0/screen_size.x, 2.0/screen_size.y);
    var ndcOffset: vec2<f32> = vec2(inPos.x * inBasis[inId].xy + inPos.y * inBasis[inId].zw) * basisViewport;

    out.coord = inPos;
    out.color = inColors[inId];
    out.clip_position = vec4<f32>(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);

    return out;
}

@fragment
fn fs_main(in: VertexOutput) -> @location(0) vec4<f32> {
    var A = dot(in.coord * 2.0, in.coord * 2.0);
    if (A  > 4.0 * splat_radius) {
        discard;
    }
    var a = 1.0/(0.25 * sqrt(2.0*3.14))*exp(-0.5 * (in.coord.x*in.coord.x+in.coord.y*in.coord.y)/(0.25*0.25));
    return vec4<f32>(in.color.rgb, in.color.a * a);
}

// @compute
// fn cs_main(@buildin:(global_invocation_id) global_id:vec3<u32>){

// }`;class pe{_renderPipeline;_numVertices;_splatBindGroup;_splatPositionBuffer;_splatIdsBuffer;_basisBuffer;_splats;constructor(r,M,D){const E=r.createShaderModule({code:de}),S=new Float32Array(M.flatMap(b=>[...b.position,0])),_=new Float32Array(M.flatMap(b=>[...b.basis])),z=new Float32Array(M.flatMap(b=>[...b.color,b.opacity])),U=r?.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]}),A=r?.createBuffer({size:4*Float32Array.BYTES_PER_ELEMENT*M.length,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX,mappedAtCreation:!0}),V=A.getMappedRange();new Float32Array(V).set(S),A.unmap();const G=r?.createBuffer({size:4*Float32Array.BYTES_PER_ELEMENT*M.length,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),I=G.getMappedRange();new Float32Array(I).set(_),G.unmap();const L=r?.createBuffer({size:4*Float32Array.BYTES_PER_ELEMENT*M.length,usage:GPUBufferUsage.STORAGE,mappedAtCreation:!0}),O=L.getMappedRange();new Float32Array(O).set(z),L.unmap();const H=r?.createBindGroup({layout:U,entries:[{binding:0,resource:{buffer:A}},{binding:1,resource:{buffer:G}},{binding:2,resource:{buffer:L}}]}),j=new Float32Array([1,1,-1,1,1,-1,-1,-1]),m=r?.createBuffer({size:2*Float32Array.BYTES_PER_ELEMENT*4,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),J=m.getMappedRange();new Float32Array(J).set(j),m.unmap();const $={arrayStride:2*Float32Array.BYTES_PER_ELEMENT,stepMode:"vertex",attributes:[{format:"float32x2",offset:0,shaderLocation:0}]},Q=new Uint32Array(M.length).fill(0).map((b,an)=>an),Y=r?.createBuffer({size:Uint32Array.BYTES_PER_ELEMENT*M.length,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),Z=Y.getMappedRange();new Uint32Array(Z).set(Q),Y.unmap();const fn={arrayStride:Uint32Array.BYTES_PER_ELEMENT,stepMode:"instance",attributes:[{format:"uint32",offset:0,shaderLocation:1}]},cn={format:"bgra8unorm",blend:{alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}},en=r.createRenderPipeline({layout:r.createPipelineLayout({bindGroupLayouts:[D,U]}),vertex:{module:E,entryPoint:"vs_main",buffers:[$,fn]},fragment:{module:E,entryPoint:"fs_main",targets:[cn]},primitive:{topology:"triangle-strip",frontFace:"ccw",cullMode:"none"}});this._renderPipeline=en,this._numVertices=M.length,this._splatBindGroup=H,this._splatPositionBuffer=m,this._splatIdsBuffer=Y,this._splats=M,this._basisBuffer=G}updateBasisBuffer(r,M,D,E,S){for(let A=0;A<this._splats.length;A++)this._splats[A].updateBasis(M,D,E),A==0&&console.log(this._splats[A]);const _=r?.createBuffer({size:4*Float32Array.BYTES_PER_ELEMENT*this._splats.length,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),z=new Float32Array(_.getMappedRange()),U=this._splats.flatMap(A=>[A.basis[0],A.basis[1],A.basis[2],A.basis[3]]);return z.set(U),_.unmap(),S.copyBufferToBuffer(_,0,this._basisBuffer,0,4*Float32Array.BYTES_PER_ELEMENT*this._splats.length),_}updateSplatIndexBuffer(r,M,D,E){const S=[];for(let A=0;A<this._splats.length;++A){const V=Nn.fromValues(this._splats[A].position[0],this._splats[A].position[1],this._splats[A].position[2],1),G=Nn.transformMat4(V,D),I=Nn.transformMat4(G,M);S.push(I[2]/I[3])}const _=Array.from({length:S.length},(A,V)=>V);_.sort((A,V)=>S[A]-S[V]);const z=new Uint32Array(_),U=r.createBuffer({size:_.length*Uint32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0});return new Uint32Array(U.getMappedRange()).set(z),U.unmap(),E.copyBufferToBuffer(U,0,this._splatIdsBuffer,0,_.length*Uint32Array.BYTES_PER_ELEMENT),U}render(r,M){r.setPipeline(this._renderPipeline),r.setBindGroup(0,M),r.setBindGroup(1,this._splatBindGroup),r.setVertexBuffer(0,this._splatPositionBuffer),r.setVertexBuffer(1,this._splatIdsBuffer);for(let D=this._numVertices-1;D>=0;D--)r.draw(4,1,0,D)}}class Me{static async init(r){if(navigator.gpu==null)throw new Error("WebGPU not supported on this browser.");const M=await navigator.gpu.requestAdapter();if(M==null)throw new Error("Failed to request GPU adapter.");const D=await M.requestDevice();if(D==null)throw new Error("Failed to request GPU device.");const E=r.getContext("webgpu");if(E==null)throw new Error("Failed to request GPU context.");E.configure({device:D,format:navigator.gpu.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT});const S=new It,_={splatRadius:1};S.add(_,"splatRadius",.1,2,.1);const z=D?.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),U=D?.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),A=D?.createBuffer({size:2*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),V=D?.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),G=D.createBuffer({size:Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),I=D?.createBindGroup({layout:z,entries:[{binding:0,resource:{buffer:U}},{binding:1,resource:{buffer:V}},{binding:2,resource:{buffer:A}},{binding:3,resource:{buffer:G}}]}),O=await(await fetch("/assets/ply/food.ply")).blob(),H=new File([O],"food.ply"),j=new we;await j.loadPlyFile(H);const m=new pe(D,j.getSplattifiedVertices(),z),J=new bt([0,0,-1],[0,0,0],[0,1,0],1,[r.width,r.height]),$={colorAttachments:[{view:E.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:1},storeOp:"store"}]};let Q=it.zero();const Y=function(){let en=!1;it.distance(Q,J.eyePos())>.5&&(Q=it.create(J.eyePos()[0],J.eyePos()[1],J.eyePos()[2]),en=!0);const b=wt.perspective(1.4,r.width/r.height,.001,5e3),an=D.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0});new Float32Array(an.getMappedRange()).set(b),an.unmap();const hn=D.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0});new Float32Array(hn.getMappedRange()).set(J.camera),hn.unmap();const tn=D.createBuffer({size:2*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0});new Float32Array(tn.getMappedRange()).set([r.width,r.height]),tn.unmap();const C=D.createBuffer({size:Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),yn=new Float32Array(C.getMappedRange());yn[0]=_.splatRadius,C.unmap(),$.colorAttachments[0].view=E.getCurrentTexture().createView();const wn=D.createCommandEncoder();wn.copyBufferToBuffer(an,0,U,0,16*Float32Array.BYTES_PER_ELEMENT),wn.copyBufferToBuffer(tn,0,A,0,2*Float32Array.BYTES_PER_ELEMENT),wn.copyBufferToBuffer(hn,0,V,0,16*Float32Array.BYTES_PER_ELEMENT),wn.copyBufferToBuffer(C,0,G,0,Float32Array.BYTES_PER_ELEMENT);const un=m.updateBasisBuffer(D,b,J.camera,r,wn);let Bn=null;en&&(Bn=m.updateSplatIndexBuffer(D,b,J.camera,wn));const gn=wn.beginRenderPass($);m.render(gn,I),gn.end(),D.queue.submit([wn.finish()]),an.destroy(),tn.destroy(),hn.destroy(),C.destroy(),un.destroy(),Bn?.destroy()};requestAnimationFrame(Y);let Z=null;const fn=new ResizeObserver(en=>{Z&&clearTimeout(Z),Z=setTimeout(()=>{requestAnimationFrame(Y)},100)});requestAnimationFrame(Y),fn.observe(r);const cn=new Ct;cn.mousemove=function(en,b,an){an.buttons==1?(J.rotate(en,b),requestAnimationFrame(Y)):an.buttons==4&&(J.pan([b[0]-en[0],en[1]-b[1]]),requestAnimationFrame(Y))},cn.wheel=function(en){J.zoom(en*2),requestAnimationFrame(Y)},cn.registerForCanvas(r)}}const Wn=document.getElementById("webgpu-canvas");Wn?(Wn.width=Wn.clientWidth,Wn.height=Wn.clientHeight,Me.init(Wn).catch(e=>{console.error("Failed to initialize RenderEngine:",e);const r=document.createElement("div");r.innerHTML=`
            <h2>Initialization Failed</h2>
            <p>Could not start the WebGPU engine. Please ensure your browser supports WebGPU and is up to date.</p>
            <pre>${e.message}</pre>
        `,document.body.innerHTML="",document.body.appendChild(r)})):console.error("Fatal error: Could not find a canvas element with id 'webgpu-canvas'");
